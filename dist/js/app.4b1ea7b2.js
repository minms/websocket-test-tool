(function(e){function t(t){for(var n,a,r=t[0],l=t[1],c=t[2],u=0,h=[];u<r.length;u++)a=r[u],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&h.push(i[a][0]),i[a]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);d&&d(t);while(h.length)h.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],n=!0,r=1;r<s.length;r++){var l=s[r];0!==i[l]&&(n=!1)}n&&(o.splice(t--,1),e=a(a.s=s[0]))}return e}var n={},i={app:0},o=[];function a(t){if(n[t])return n[t].exports;var s=n[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,a),s.l=!0,s.exports}a.m=e,a.c=n,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(s,n,function(t){return e[t]}.bind(null,n));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],l=r.push.bind(r);r.push=t,r=r.slice();for(var c=0;c<r.length;c++)t(r[c]);var d=l;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var n=s("85ec"),i=s.n(n);i.a},"56d7":function(e,t,s){"use strict";s.r(t);var n=s("2b0e"),i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"app"}},[s("el-form",{attrs:{inline:!0}},[s("el-form-item",{attrs:{label:""}},[s("el-input-number",{attrs:{min:1,max:1e3,placeholder:"初始化连接数量"},on:{change:e.handleInit},model:{value:e.clientTotal,callback:function(t){e.clientTotal=t},expression:"clientTotal"}})],1),s("address-config",{model:{value:e.address,callback:function(t){e.address=t},expression:"address"}})],1),s("el-form",{attrs:{inline:!0}},[s("el-form-item",{attrs:{label:""}},[s("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:"批量发送内容"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1),s("el-form-item",{attrs:{label:""}},[s("el-button",{attrs:{type:"primary",disabled:!e.content},on:{click:e.wsSend}},[s("i",{staticClass:"el-icon-s-promotion"})])],1)],1),s("el-row",{attrs:{gutter:20}},e._l(e.clientTotal,(function(t){return s("el-col",{key:t,style:{marginBottom:e.clientTotal>3?"20px":"0"},attrs:{span:e.colSpan}},[s("websocket-client",{ref:"client-"+t,refInFor:!0,attrs:{index:t,address:e.address}})],1)})),1)],1)},o=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-card",{staticClass:"websocket-client"},[s("div",{staticStyle:{"font-weight":"bold","font-size":"14px"},attrs:{slot:"header"},slot:"header"},[e._v("第"),s("b",[e._v(e._s(e.index))]),e._v("个客户端 "),e.isConnected?s("span",{staticClass:"el-icon-open green"}):e._e(),e.isConnected?e._e():s("span",{staticClass:"el-icon-turn-off gray"}),s("address-config",{staticStyle:{float:"right"},attrs:{type:"link",index:e.index},on:{change:e.handleAddressChange},model:{value:e.addressCustom,callback:function(t){e.addressCustom=t},expression:"addressCustom"}},[e._v(e._s(e.connectionAddress||"配置连接")+" ")])],1),s("div",{ref:"messages",staticClass:"messages"},[e._l(e.messages,(function(t,n){return s("div",{key:n,staticClass:"message"},[s("div",{staticClass:"user",class:"server"===t.user?"server":""},[e._v(e._s("server"===t.user?"服务器":"我")+" ("+e._s(t.time)+") ")]),s("div",{staticClass:"content"},[e._v(e._s(t.data))])])})),s("div",{staticStyle:{"line-height":"20px","font-size":"10px",color:"gray","text-align":"center"}},[e._v("--- 已是最后一条消息 ---")])],2),s("div",{staticClass:"toolbar"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:21}},[s("el-input",{attrs:{type:"input",placeholder:"请输入内容"},model:{value:e.content,callback:function(t){e.content=t},expression:"content"}})],1),s("el-col",{attrs:{span:3}},[s("el-button",{attrs:{type:"primary",disabled:!e.isConnected||!e.content},on:{click:function(t){return e.wsSend(null)}}},[s("i",{staticClass:"el-icon-s-promotion"})])],1)],1)],1)])},r=[],l=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticStyle:{display:"inline-block"}},["link"!==e.type?s("el-button",{on:{click:e.showDialog}},[e._t("default",[e._v("配置连接地址")])],2):e._e(),"link"===e.type?s("el-link",{on:{click:e.showDialog}},[e._t("default",[e._v("配置连接地址")])],2):e._e()],1)},c=[],d={name:"address-config",props:["type","value","index"],data(){return{visible:!1,address:null,cacheKey:""}},watch:{value:{immediate:!0,handler(e){this.address=e}}},created(){this.cacheKey=void 0===this.index?"websocket-test-address":`websocket-test-address-${this.index}`,this.loadFromStorage()},methods:{loadFromStorage(){let e=localStorage.getItem(this.cacheKey);e&&(this.$emit("input",e),this.$emit("change"))},showDialog(){this.$prompt("请输入连接地址","提示",{inputValue:this.address,confirmButtonText:"确定",cancelButtonText:"取消",inputErrorMessage:"输入格式不正确",closeOnClickModal:!1}).then(({value:e})=>{localStorage.setItem(this.cacheKey,e),this.$emit("input",e),this.$emit("change")}).catch(()=>{})}}},u=d,h=s("2877"),p=Object(h["a"])(u,l,c,!1,null,"2ae97b24",null),f=p.exports,m={name:"websocket-client",components:{AddressConfig:f},props:["index","address"],data(){return{addressCustom:"",content:"",messages:[],connectionAddress:null,client:null,isConnected:!1,isConnecting:!1}},watch:{address:{immediate:!0,handler(e){this.connectionAddress=this.addressCustom||e,this.connectionAddress&&this.connection()}},addressCustom:{immediate:!0,handler(e){this.connectionAddress=this.addressCustom||e,this.connectionAddress&&this.connection()}}},mounted(){this.updateMessagesScroll(),this.connectionAddress=this.addressCustom||this.address},beforeDestroy(){console.log("beforeDestroy")},methods:{updateMessagesScroll(){setTimeout(()=>{this.$refs.messages.scrollTop=this.$refs.messages.scrollHeight+100},50)},handleAddressChange(){this.connectionAddress=this.addressCustom||this.address,this.client&&this.client.close(),this.isConnecting=this.isConnected=!1,this.connection()},connection(){this.isConnecting||this.isConnected||this.connectionAddress&&(this.isConnecting=!0,this.client=new WebSocket(this.connectionAddress),this.client.onopen=this.wsOpen,this.client.onerror=this.wsError,this.client.onmessage=this.wsMessage,this.client.onclose=this.wsClose)},wsOpen(e){this.isConnecting=!1,this.isConnected=!0},wsError(e){this.isConnecting=!1,this.isConnected=!1},wsMessage(e){this.pushMessage("server",e.data)},wsClose(e){this.isConnecting=!1,this.isConnected=!1},wsSend(e=null){if(!this.isConnected)return;let t=e||this.content;t=t.replace("{index}",this.index),this.client.send(t),this.pushMessage("user",t)},pushMessage(e,t){let s=new Date;this.messages.push({user:e,data:t,time:s.toLocaleTimeString()}),this.updateMessagesScroll()}}},g=m,b=(s("a7ea"),Object(h["a"])(g,a,r,!1,null,"58c30630",null)),v=b.exports,C={name:"app",components:{AddressConfig:f,WebsocketClient:v},data(){return{address:"",clientTotal:1,content:""}},computed:{colSpan(){return 1===this.clientTotal?24:2===this.clientTotal?12:8}},created(){let e=localStorage.getItem("websocket-test-total");e>0&&(this.clientTotal=parseInt(e))},methods:{handleInit(){localStorage.setItem("websocket-test-total",this.clientTotal)},wsSend(){for(let e=1;e<=this.clientTotal;e++)this.$refs["client-"+e][0].wsSend(this.content)}}},w=C,y=(s("034f"),Object(h["a"])(w,i,o,!1,null,null,null)),_=y.exports,x=s("2f62");n["default"].use(x["a"]);var k=new x["a"].Store({state:{},mutations:{},actions:{},modules:{}}),S=s("5c96"),T=s.n(S);s("0fae");n["default"].use(T.a),n["default"].config.productionTip=!1,new n["default"]({store:k,render:function(e){return e(_)}}).$mount("#app")},"85ec":function(e,t,s){},a7ea:function(e,t,s){"use strict";var n=s("b999"),i=s.n(n);i.a},b999:function(e,t,s){}});
//# sourceMappingURL=app.4b1ea7b2.js.map